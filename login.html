<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CIU | Login</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
  <script>
    emailjs.init("1xYQGxOC2JBKdb3vC");
  </script>
  <style>
    body { text-align: center; font-family: Arial; padding-top: 50px; }
    input { padding: 10px; margin: 10px; width: 250px; }
    button { padding: 10px 20px; background: darkred; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>

  <img src="ciu-logo.png" alt="CIU Logo" width="150"><br>
  <h2>Login</h2>

  <div id="step1">
    <input type="email" id="email" placeholder="Enter your CIU email" required>
    <br>
    <button onclick="sendCode()">Login by E-Mail</button>
  </div>

  <div id="step2" style="display:none;">
    <input type="text" id="codeInput" placeholder="Enter verification code">
    <br>
    <button onclick="verifyCode()">Verify</button>
  </div>

  <p id="msg" style="color: green;"></p>

  <script>
    let generatedCode = "";

    function sendCode() {
      const email = document.getElementById("email").value;
      if (!email) return alert("Please enter your email.");

      // Generate 6-digit random code
      generatedCode = Math.floor(100000 + Math.random() * 900000).toString();

      const templateParams = {
        to_email: email,
        code: generatedCode
      };

      emailjs.send("service_th5035j", "template_90zrpeq", templateParams)
        .then(() => {
          document.getElementById("msg").innerText = "Verification code sent!";
          document.getElementById("step1").style.display = "none";
          document.getElementById("step2").style.display = "block";
        }, (error) => {
          alert("Failed to send code. Please try again.");
          console.error(error);
        });
    }

    function verifyCode() {
      const inputCode = document.getElementById("codeInput").value;
      if (inputCode === generatedCode) {
        window.location.href = "dashboard.html"; // أو أي صفحة بعد الدخول
      } else {
        alert("Incorrect code. Try again.");
      }
    }
  </script>

</body>
</html>
